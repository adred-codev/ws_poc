version: '3'

# Utility tasks for installation, formatting, and cleanup

vars:
  GO_SERVER_DIR: ../src
  PUBLISHER_DIR: ../publisher

tasks:
  install:
    desc: Install all dependencies
    cmds:
      - task: install:go
      - task: install:publisher

  install:go:
    desc: Install Go dependencies
    dir: "{{.GO_SERVER_DIR}}"
    cmds:
      - go mod download

  install:publisher:
    desc: Install publisher Node.js dependencies
    dir: "{{.PUBLISHER_DIR}}"
    cmds:
      - npm install

  format:
    desc: Format all code
    cmds:
      - task: format:go
      - task: format:ts

  format:go:
    desc: Format Go code
    dir: "{{.GO_SERVER_DIR}}"
    cmds:
      - gofmt -w .

  format:ts:
    desc: Format TypeScript code
    dir: "{{.PUBLISHER_DIR}}"
    cmds:
      - npm run format || echo "⚠️  Prettier not configured"

  clean:
    desc: Clean all build artifacts
    cmds:
      - task: clean:go
      - task: clean:publisher

  clean:go:
    desc: Clean Go build artifacts
    dir: "{{.GO_SERVER_DIR}}"
    cmds:
      - rm -f server
      - go clean

  clean:publisher:
    desc: Clean publisher build artifacts
    dir: "{{.PUBLISHER_DIR}}"
    cmds:
      - npm run clean || rm -rf dist
