version: '3'

# Docker container management tasks

tasks:
  up:
    desc: Start all services (detached)
    cmds:
      - docker compose up -d
      - echo "✅ All services started"
      - echo "   WebSocket ws://localhost:3004/ws"
      - echo "   Health http://localhost:3004/health"
      - echo "   Publisher http://localhost:3003/stats"
      - echo "   Grafana http://localhost:3010 (admin/admin)"
      - echo "   Prometheus http://localhost:9091"

  down:
    desc: Stop and remove all containers
    cmds:
      - docker compose down

  restart:
    desc: Restart all services
    cmds:
      - task: down
      - task: up

  rebuild:
    desc: Rebuild and restart specific service (SERVICE=ws-go|publisher)
    cmds:
      - docker compose up -d --build {{.SERVICE}}

  logs:
    desc: Tail all service logs
    cmds:
      - docker compose logs -f

  logs:go:
    desc: Tail Go server logs
    cmds:
      - docker compose logs -f ws-go

  logs:publisher:
    desc: Tail publisher logs
    cmds:
      - docker compose logs -f publisher

  logs:nats:
    desc: Tail NATS logs
    cmds:
      - docker compose logs -f nats

  logs:prometheus:
    desc: Tail Prometheus logs
    cmds:
      - docker compose logs -f prometheus

  logs:grafana:
    desc: Tail Grafana logs
    cmds:
      - docker compose logs -f grafana

  ps:
    desc: Show running containers
    cmds:
      - docker compose ps

  clean:
    desc: Remove containers, volumes, and orphans
    cmds:
      - docker compose down -v --remove-orphans
      - echo "✅ Cleaned up all Docker resources"
