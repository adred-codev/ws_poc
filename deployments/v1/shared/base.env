# =============================================================================
# Shared Base Configuration
# =============================================================================
# Purpose: Common defaults for all environments (local, GCP, etc.)
# Override: Set environment-specific values in local/overrides.env or gcp/overrides.env
#
# Load Order (lowest to highest priority):
#   1. This file (base.env)
#   2. kafka-topics.env
#   3. ports.env
#   4. Environment-specific overrides.env
#   5. .env.local or .env.production (secrets, gitignored)
#   6. docker-compose.yml environment section

# =============================================================================
# SERVER
# =============================================================================
# WebSocket server listen address (same for all environments)
WS_ADDR=:3002

# =============================================================================
# RATE LIMITING
# =============================================================================
# Production-validated defaults
WS_MAX_KAFKA_RATE=1000
WS_MAX_BROADCAST_RATE=25

# =============================================================================
# CONNECTION RATE LIMITING (DoS Protection)
# =============================================================================
# Protects against connection flood attacks using token bucket algorithm
# Per-IP limits: Prevents single IP from flooding
# Global limits: Prevents system-wide overload
# TEMPORARILY DISABLED FOR TESTING (2025-11-15)
CONN_RATE_LIMIT_ENABLED=false
CONN_RATE_LIMIT_IP_BURST=100          # Max burst connections per IP
CONN_RATE_LIMIT_IP_RATE=100.0         # Sustained conn/sec per IP
CONN_RATE_LIMIT_GLOBAL_BURST=300      # Max burst system-wide
CONN_RATE_LIMIT_GLOBAL_RATE=50.0      # Sustained conn/sec system-wide

# =============================================================================
# SAFETY THRESHOLDS
# =============================================================================
# CPU thresholds for connection control
WS_CPU_REJECT_THRESHOLD=75.0
WS_CPU_PAUSE_THRESHOLD=75.0

# =============================================================================
# TCP/NETWORK TUNING (Trading Platform Burst Tolerance)
# =============================================================================
# Improves tolerance to connection bursts for trading platform fairness
# Set TCP_LISTEN_BACKLOG=0 to revert to Go defaults (~128)
# REVERSIBILITY: All changes fully reversible via environment variables
TCP_LISTEN_BACKLOG=2048    # TCP accept queue size (default: 2048, Go default: ~128)
HTTP_READ_TIMEOUT=15s      # HTTP server read timeout (default: 15s, was: 5s)
HTTP_WRITE_TIMEOUT=15s     # HTTP server write timeout (default: 15s, was: 5s)
HTTP_IDLE_TIMEOUT=60s      # HTTP server idle timeout (default: 60s, was: 10s)

# =============================================================================
# LOGGING
# =============================================================================
# Structured logging for Loki/Grafana
LOG_LEVEL=info
LOG_FORMAT=json

# =============================================================================
# MONITORING
# =============================================================================
# Metrics collection interval
METRICS_INTERVAL=15s

# =============================================================================
# WORKER POOL (Auto-calculated if set to 0)
# =============================================================================
# Set to 0 to auto-calculate based on CPU
# Formula: max(32, CPU_LIMIT * 2)
WS_WORKER_POOL_SIZE=0

# Set to 0 to auto-calculate based on pool size
# Formula: WORKER_POOL_SIZE * 100
WS_WORKER_QUEUE_SIZE=0
