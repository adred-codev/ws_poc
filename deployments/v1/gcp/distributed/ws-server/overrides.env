# =============================================================================
# GCP Production Overrides
# =============================================================================
# Purpose: Override shared/base.env for GCP production deployment
# Load order: base.env → kafka-topics.env → ports.env → overrides.env → .env.production
# Instance: e2-standard-4 (4 vCPU, 16GB RAM)
# Target: 12,000 connections @ 1 core

ENVIRONMENT=production

# =============================================================================
# KAFKA CONNECTION
# =============================================================================
# Note: KAFKA_BROKERS is set in .env.production (generated by deployment script)
# This file only overrides the consumer group ID
KAFKA_GROUP_ID=ws-server-production

# =============================================================================
# RESOURCE LIMITS (Production e2-standard-4)
# =============================================================================
# Strategy: Maximize RAM, minimize CPU (1 core avoids scheduler overhead)
# Target: 12K connections @ ~30% CPU, ~46% memory
WS_CPU_LIMIT=1
WS_MEMORY_LIMIT=15569256448  # 14.5 GB (90% of 16GB)
WS_MAX_CONNECTIONS=12000

# =============================================================================
# WORKER POOL (Production-validated for 12K connections @ 1 core)
# =============================================================================
# CRITICAL: These values are empirically validated for single-core execution
# Formula: max(32, connections/40) = max(32, 12000/40) = 300 → tuned to 192
# DO NOT increase - causes goroutine scheduling thrashing on GOMAXPROCS=1
WS_WORKER_POOL_SIZE=192  # Empirically validated for 1 core
WS_WORKER_QUEUE_SIZE=19200  # 192 * 100

# =============================================================================
# RATE LIMITING (Production-validated)
# =============================================================================
WS_MAX_KAFKA_RATE=25  # Override: Based on 40K tx/day peak metrics

# =============================================================================
# GOROUTINE LIMIT (Calculated for production capacity)
# =============================================================================
# Formula: ((12,000 × 2) + 192 + 13) × 1.2 = 29,046 → 30,000
# Breakdown: (connections × 2 goroutines) + workers + overhead
WS_MAX_GOROUTINES=30000
