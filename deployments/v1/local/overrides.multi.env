# =============================================================================
# Local Development Overrides - MULTI-CORE CAPACITY TEST MODE
# =============================================================================
# Purpose: Override shared/base.env for multi-core local capacity testing
# Load order: base.env → kafka-topics.env → ports.env → overrides.multi.env → .env.local
# Target: 12,000+ connections (distributed across 3 shards @ 4K each)
# Resources: 3 CPU cores (1 per shard), 14GB RAM total
#
# Architecture Notes:
#   - Each shard has its own Kafka consumer group (e.g., ws-server-local-0, ws-server-local-1, ws-server-local-2)
#   - BroadcastBus coordinates message distribution across all shards
#   - LoadBalancer uses "least connections" strategy for even distribution
#   - Per-shard max connections: WS_MAX_CONNECTIONS / num_shards

ENVIRONMENT=local-multi

# =============================================================================
# KAFKA/REDPANDA
# =============================================================================
KAFKA_BROKERS=redpanda:9092
KAFKA_CONSUMER_GROUP=ws-server-local  # Base name; shards append -0, -1, -2

# =============================================================================
# RESOURCE LIMITS (Multi-Core Distribution)
# =============================================================================
# Strategy: Distribute 12K connections across 3 shards (4K per shard)
# CPU: 3 cores total (1 core per shard, managed by Docker CPU limits)
# Memory: 14GB total (distributed across shards, ~4.7GB per shard)
WS_CPU_LIMIT=3                # Total CPU limit (Docker distributes across shards)
WS_MEMORY_LIMIT=15032385536   # 14 GB total (same as single-core)
WS_MAX_CONNECTIONS=12000      # Total connections (divided by shard count in code)

# =============================================================================
# RATE LIMITING (Production-validated)
# =============================================================================
WS_MAX_KAFKA_RATE=25         # Kafka message consumption rate per shard
WS_MAX_BROADCAST_RATE=25     # Broadcast rate limit per shard

# =============================================================================
# GOROUTINE LIMIT (Calculated for multi-core capacity)
# =============================================================================
# Formula per shard: ((4,000 × 2) + overhead) × 1.2 ≈ 10,000 per shard
# Total: 30,000 (matches single-core for compatibility)
WS_MAX_GOROUTINES=30000

# =============================================================================
# LOGGING (Production-like for performance)
# =============================================================================
LOG_LEVEL=info     # Production level for accurate performance
LOG_FORMAT=json    # Production format
