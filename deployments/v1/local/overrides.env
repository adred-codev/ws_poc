# =============================================================================
# Local Development Overrides - CAPACITY TEST MODE
# =============================================================================
# Purpose: Override shared/base.env for local capacity testing
# Load order: base.env → kafka-topics.env → ports.env → overrides.env → .env.local
# Target: 12,000 connections (matching GCP production config)
# Resources: Match GCP e2-standard-4 settings for validation

ENVIRONMENT=local

# =============================================================================
# KAFKA/REDPANDA
# =============================================================================
KAFKA_BROKERS=redpanda:9092
KAFKA_CONSUMER_GROUP=ws-server-local

# =============================================================================
# RESOURCE LIMITS (Matching GCP Production e2-standard-4)
# =============================================================================
# Strategy: Match GCP production configuration for 12K validation
# Target: 12K connections @ ~29% CPU on 1 core (validated in old_ws)
WS_CPU_LIMIT=1
WS_MEMORY_LIMIT=15569256448  # 14.5 GB (90% of 16GB) - same as GCP
WS_MAX_CONNECTIONS=12000

# =============================================================================
# WORKER POOL (Production-validated for 12K connections @ 1 core)
# =============================================================================
# CRITICAL: These values are empirically validated for single-core execution
# Copied from GCP production config
WS_WORKER_POOL_SIZE=192  # Empirically validated for 1 core
WS_WORKER_QUEUE_SIZE=19200  # 192 * 100

# =============================================================================
# RATE LIMITING (Production-validated)
# =============================================================================
WS_MAX_KAFKA_RATE=25  # Match GCP: Based on 40K tx/day peak metrics

# =============================================================================
# GOROUTINE LIMIT (Calculated for production capacity)
# =============================================================================
# Formula: ((12,000 × 2) + 192 + 13) × 1.2 = 29,046 → 30,000
# Breakdown: (connections × 2 goroutines) + workers + overhead
WS_MAX_GOROUTINES=30000

# =============================================================================
# LOGGING (Production-like for performance)
# =============================================================================
LOG_LEVEL=info     # Production level for accurate performance
LOG_FORMAT=json    # Production format
